<html lang="en">
<head>
    <title>Lightshow Control Panel</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.8/socket.io.min.js">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <style>
        .slidecontainer {
            width: 100%;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }

        .button-selected {
            background-color: #a42543;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }

        .color {
            -webkit-appearance: none;
            background-color: #4CAF50;
            width: 100%;
            padding: 0 10px;
            margin: 4px 2px;
            font-size: 16px;
        }
    </style>
</head>
<body>
<header id="header">

</header>

<section>
    <header>
        <h1>Lightshow Control Panel</h1>
        <h2>Version 0.2 Alpha</h2>
        <div>
            <button id="power"></button>
        </div>
    </header>
    <section>
        <h3>Settings</h3>
        <div id="settings">
            {# This will be generated by JavaScript #}
        </div>
    </section>
    <section>
        <h3>Animations</h3>
        <div id="animations">
            {# This will be generated by JavaScript #}
        </div>
    </section>
</section>

</body>
<script>
    String.prototype.format = function () {
        let a = this;
        for (let k in arguments) {
            a = a.replace(new RegExp("\\{" + k + "\\}", 'g'), arguments[k]);
        }
        return a
    }

    let socket = io();

    let state; // Are the LEDS on or off
    let settings = [];
    let animations = [];
    let animation = 0;

    // JQuerry selectors
    let $power = $("#power");

    function load_power() {
        $power.text("Turn ".concat(state ? "off" : "on"));
        document.getElementById("power").className = state ? "button-selected" : "button";
    }

    function load_settings() {
        document.getElementById("settings").innerHTML = "";
        for (let index = 0; index < settings.length; index++) {
            switch (settings[index]["type"]) {
                case "slider":
                    document.getElementById("settings").innerHTML += "<div class=\"slidecontainer\">\n";
                    document.getElementById("settings").innerHTML +=
                        "<label htmlFor={0}>{1}</label>\n<input onChange='socket.emit(\"setting\", {5}, this.value)' class=slider type='range' step={6} min={2} max={3} value={4} id={0}>".format(
                            settings[index]["name"],
                            settings[index]["name"].charAt(0).toUpperCase() + settings[index]["name"].slice(1),
                            settings[index]["range"][0], settings[index]["range"][1], settings[index]["value"],
                            index, settings[index]["step"]
                        );
                    document.getElementById("settings").innerHTML += "</div>";
                    break;
                case "color":
                    break;
                case "text":
                    break;
                default:
                    break;
            }
        }
    }

    function load_animations() {
        document.getElementById("animations").innerHTML = "<div>";
        for (let index = 0; index < animations.length; index++) {
            if (index === animation) {
                document.getElementById("animations").innerHTML +=
                    "<button class='button-selected' onClick='socket.emit(\"animation\", {1})' id={0}>{0}</button>".format(animations[index], index);
            } else {
                document.getElementById("animations").innerHTML +=
                    "<button class='button' onClick='socket.emit(\"animation\", {1})' id={0}>{0}</button>".format(animations[index], index);
            }
        }
        document.getElementById("animations").innerHTML += "</div>";
    }

    socket.on("connect", function () {
        console.log("Connected to server");
    });

    $power.click(function () {
        socket.emit("power");
        return false;
    });

    socket.on("power", function (_state) {
        state = _state;
        load_power();
    });

    socket.on("settings", function (_settings) {
        settings = _settings;
        load_settings();
    });

    socket.on('animations', function (_animations) {
        animations = _animations;
        load_animations();
    })

    socket.on('animation', function (_animation) {
        animation = _animation;
        load_animations();
    })
</script>
</html>